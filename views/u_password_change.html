<framify menu="false" path="u_change_password" url="/u_change_password/:email/:token" title="Password Change" parent="false" icon="security" controller="appController" ></framify>
<ion-content scrollbar-x="false" scrollbar-y="false" style="padding-bottom:20px;">

    <div class="col-lg-12" id="response" ng-init="fetch([['users', { email: urlParams.email, password: urlParams.token, specifics:'name'  }]])"></div>

<json-formatter json="urlParams" open="1"></json-formatter>

    <div class="" ng-if="!(fetched.users.length > 0)">
      <center>
          <ion-spinner class="balanced" icon="crescent"></ion-spinner> 
          <br> Verifying identity ... 
      </center>  
    </div>

    <div class="" ng-if="fetched.users.length > 0" ng-controller="hospitalCtrl">
        

        <h4><center>Thank you {{fetched.users[0].name}}, please enter your new password. </center></h4>

        <div name="change_password_form"  class="col-lg-10" style=""  novalidate>

            <!-- password-->
            <div class="form-group">
                <label>Password<sup style="color:red">*</sup></label>
                <input type="password" name="password" class="form-control"  placeholder="PASSWORD"
                    ng-model="data.users.password"
                    ng-minlength="1"
                    ng-maxlength="50"
                    ng-pattern="app.ispassword"
                    required>
                    
                <div class="help-block" ng-messages="change_password_form.password.$error" ng-if="change_password_form.password.$touched">
                        <p ng-message="minlength">That password is too short.</p>
                        <p ng-message="maxlength">That password is too long.</p>
                        <p ng-message="required">A password is required.</p>
                        <p ng-message="pattern">Please enter a stronger password</p>
                </div>
            </div>

            <!-- password 2-->
            <div class="form-group">
                <label>Confirm Password <sup style="color:red">*</sup></label>
                <input type="password" name="password2" class="form-control" placeholder="CONFIRM PASSWORD"
                    ng-model="data.users.password2"
                    ng-minlength="1"
                    ng-maxlength="50"
                    ng-pattern="app.ispassword"
                    required>
                    
                <div class="help-block" ng-messages="change_password_form.password2.$error" ng-if="change_password_form.password2.$touched">
                        <p ng-message="minlength">That password is too short.</p>
                        <p ng-message="maxlength">That password is too long.</p>
                        <p ng-message="required">A password is required.</p>
                        <p ng-message="pattern">Please enter a stronger password</p>
                </div>
            </div>

            <div ng-if="change_password_form.password2.$touched && (data.users.password != data.users.password2)">
                <div class="alert alert-danger">
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    The passwords do not match!
                </div>
            </div>

            <span hidden ng-if="data.users.password && (data.users.password === data.users.password2)"> {{data.users = setCreds(data.users)}}</span>
            <span hidden ng-if="data.users.token">{{ data.users = addExtras( data.users, urlParams, 'token:password' ) }}</span>

            <div class="form-group">
                <button 
                ng-disabled=" change_password_form.$invalid || data.users.password != data.users.password2" 
                ng-click="update('users',data.users,'response','password,password2')" 
                class=" button button-positive"
                >Change Password</button>
            </div>

        </div>
        

    </div>

</ion-content>